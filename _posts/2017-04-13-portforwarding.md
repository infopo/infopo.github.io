---
layout: post
title: 포트포워딩 정리
category: etc
---

1. 인터넷 연결 흐름  
외부 인터넷 선 &rarr; 모뎀(공인ip / WAN) &rarr; 공유기 &rarr; [사설ip(1), 사설ip(2), 사설ip(3), ...]  

2. 사설ip끼리 ssh 접속  
노트북ip: 172.30.1.54  
오렌지파이ip: 172.30.1.51  
노트북에서 오렌지파이를 접속할 때  
```
jw@jw-lenovo $ ssh orangepi@172.30.1.51
```  


3. 외부에서 사설ip로 ssh 접속을 할 때  
우선 172.30.1.254(관리자 페이지)로 들어가서 인터넷 연결정보에서 ip주소를 확인하고, **포트포워딩**도 해야합니다.  
```
orangepi@WAN ip주소 -p 외부포트
```  
orangepi 뒤에는 WAN ip주소가 들어가야 합니다.  

4. 포트포워딩 설정  
![_config.yml]({{ site.baseurl }}/images/portforwarding.png)  
  a. 소스ip, 소스포트는 필요없음  
  b. 외부포트: 외부(집 아닌 다른 곳)에서 공인 ip주소를 입력할 때, 이 외부포트를 지정해줘야 이에 대응하는 내부ip로 접속이 되는 구조  
  c. 내부ip: 외부포트에 해당하는 내부 ip  
  d. 내부포트: ssh접속에 필요한 port22를 지정  
  e. 프로토콜: tcp(기본)  

외부(eg. 11.34.086.44)에서 우리집에 있는 오렌지파이(ip:172.30.1.51)로 ssh접속을 하고 싶다고 하자.  
putty든 linux openssh든간에 외부에서 ip주소를 172.30.1.51로 입력해봤자 연결이 되지 않는다.  
오렌지파이의 ip주소는 공유기 내부에서만 접근이 가능하기 때문이다.  
따라서, 외부에서 접속은 WAN의 ip주소를 통해 이루어진다. 지금 우리집의 경우에는 WAN ip주소가 121.129.xx.xx다.  
그렇다고해서 단순히 외부에서 121.129.xx.xx를 입력해도 공유기의 어느 ip에 접속하는지 알 수가 없기 때문에 접속이 불가능하다.
여기서 필요한 것이 포트포워딩이다.  
이 규칙(포트포워딩)은, 외부에서 WAN ip를 입력했을 때 공유기 내부의 ip로 접근이 가능하게 해주는 기능을 한다.  
이 때, 공유기의 어느 ip에 접근할 것인가는 외부포트번호로 구분을 하는데,  
쉽게 이야기하면 외부포트번호는 방문손님이 우리 집의 특정 문으로 들어갈 수 있게 만드는 안내자 역할을 한다고 보면 된다.
