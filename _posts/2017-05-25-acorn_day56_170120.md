---
layout: post
title: Pig - 17/01/20
category: acorn수업
---

## WORDCOUNT

```
$ start-all.sh
$ mr-jobhistory-daemon.sh start historyserver
$ pwd
/home/hadoop
$ cd hadoop

$ hdfs dfs -put README.txt /user/hadoop

$ pig

///line은 사용자가 임의로 정하는 값
grunt> input_lines = LOAD 'README.txt' USING PigStorage() AS (line:chararray);
grunt> dump input_lines

///tokenize(line) 단어별로 구분 -> tuple이나 bag으로 변함(행 단위)
///flatten -> 각각 개별 값으로 바꿔라
grunt> words = FOREACH input_lines GENERATE FLATTEN(TOKENIZE(line)) AS word;

///MATCHES '\\w+' 정규표현식 - 알파벳만 있는 것들만 잡아내라
grunt> filtered_words = FILTER words BY word MATCHES '\\w+';

grunt> word_groups = GROUP filtered_words BY word;
grunt> word_count = FOREACH word_groups GENERATE group AS word, COUNT(filtered_words) AS count;
grunt> ordered_word_count = ORDER word_count BY count DESC;

grunt> STORE ordered_word_count INTO 'README_count';
grunt> cat README_count
```

---

## 영화데이터 이용한 문제

이메일에서 영화 데이터 다운로드

```
$ pwd
/home/jw/Download
$ unzip movie_data.zip
$ sudo mv *.csv /home/hadoop/practice2_pig_test/
$ pwd
/home/hadoop/pratice2_pig_test

$ hdfs dfs -put *.csv /user/hadoop
$ hdfs dfs -ls /user/hadoop
```

1. 필드명: id, name, year, rating, duration으로 로딩하고 메모리 덤프로 확인하고, schema를 확인하시오. (relation명: movies)
  ```
  grunt> movies = LOAD 'movies_data.csv' USING PigStorage(',') AS (id:int, name:chararray, year:int, rating:double, duration:double);
  grunt> dump movies
  grunt> describe movies
  ```

2. 평점 4.0이상인 영화를 출력하시오. 저장파일: movies_than_four
grunt> SPLIT student_details into student_details_1 if age <23, student_details_2 if (age>22 and age<25);
grunt> movies_than_four_all = filter movies by rating >= 4.0;
grunt> movies_than_four = foreach movies_than_four_all generate name, rating;
grunt> store movies_than_four into 'movies_than_four';
grunt> ls
grunt> cat movies_than_four
grunt> dump movies_than_four;

3. 1950년과 1960년 사이에 출시된 영화리스트를 출력하시오. 저장파일: movies_list_1950_1960
grunt> describe movies
movies: {id: int,name: chararray,year: int,rating: double,duration: double}

grunt> asdf = filter movies by year>1950 and year<1960;
grunt> asdf2 = foreach asdf generate year,name;
grunt> asdf3 = order asdf2 by name asc;
grunt> store asdf3 into 'movies_list_1950_1960';
grunt> cat movies_list_1950_1960;

4. 알파벳 A로 시작하는 영화 리스트를 출력하시오. relation이름: startswith_a_movies_list
grunt> startswith_a_movies_list = foreach movies generate name, STARTSWITH(name,'A');
#STARTSWITH는 대문자로 해야함!!
grunt> dump startswith_a_movies_list

5. 상영시간이 2시간 이상인 영화 목록을 출력하시오.
grunt> qwer = filter movies by duration>7200;
grunt> dump qwer;
